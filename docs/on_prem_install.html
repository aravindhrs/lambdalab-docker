

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Insight.io Private Cloud Version Quick Install &mdash; Lambdalab-docs 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Lambdalab-docs 1.0.0 documentation" href="index.html"/>
        <link rel="next" title="Codatlas New User Guide" href="user_guide.html"/>
        <link rel="prev" title="Lambdalab software documentation" href="index_enterprise.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index_enterprise.html" class="icon icon-home"> Lambdalab-docs
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Insight.io Private Cloud Version Quick Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-docker-and-docker-compose">Install Docker and Docker Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authentication">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clone-git-repo-for-docker-compose">Clone Git Repo for Docker Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-kerberos-authentication">Configure Kerberos Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-docker-image-and-start-docker-services">Download Docker Image and Start Docker Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-github-integration">Configure Github Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-gitlab-integration">Configure Gitlab Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upgrade-insight-io">Upgrade Insight.io</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploy-insight-io-with-multiple-machines">Deploy Insight.io with Multiple Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-process-management-with-docker-compose">Common Process Management with Docker Compose</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-process">list process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-whole-insight-io-enterprise-stack">start whole Insight.io enterprise stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-a-particular-services">start a particular services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attach-to-a-all-containers-output">attach to a all containers&#8217; output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attach-to-a-containers-output">attach to a container’s output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-and-then-clean-all-the-contains">stop and then clean all the contains</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-command-inside-similar-to-ssh">run command inside (similar to ssh)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#find-help">find help</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">Codatlas New User Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index_enterprise.html">Lambdalab-docs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index_enterprise.html">Docs</a> &raquo;</li>
        
      <li>Insight.io Private Cloud Version Quick Install</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/on_prem_install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="insight-io-private-cloud-version-quick-install">
<h1>Insight.io Private Cloud Version Quick Install<a class="headerlink" href="#insight-io-private-cloud-version-quick-install" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>This document is a step-by-step guide to install Insight.io on your private cloud server.</p>
<p>Please note that due to different internet environment in China, we have a slight different install process if you are using a machine within China. Please make sure to ignore the steps marked by (<strong>Outside of China</strong>) and instead follow the steps marked by (<strong>In China</strong>) to speed up the installation.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>In order to install Insight.io, make sure you have the following pre-requisites before you start:</p>
<ul>
<li><p class="first">A DockerHub account or a registry.lambdalab.io account (if you are in China)</p>
</li>
<li><p class="first">An Ubuntu machine with root access. Note that port80(http) and port22(ssh) need to be opened.</p>
</li>
<li><p class="first">The Ubuntu machine must fulfill the minimum system requirements:</p>
<blockquote>
<div><ul class="simple">
<li>16G RAM</li>
<li>200G Hard Drive (SSD preferred)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Make sure max virtual memory is big enough by running</p>
</li>
</ul>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sudo sysctl -w vm.max_map_count<span class="o">=</span><span class="m">262144</span>
</pre></div>
</div>
<p>If you intended to deploy the service in very huge scale (100G+ repo), you may want to talk with
insight.io team before proceeding.</p>
<p><strong>Important Security Notice</strong>
Due to its service oriented architecture, Insight.io will use certain ports for communication between services. These ports are only used internally. It is highly recommended for you to NOT expose thse ports to external network to prevent these ports to be exploited by attackers. Here are a list of these ports:</p>
<blockquote>
<div>port 8080
port 9000
port 10060
port 27017
port 28017
port 50000</div></blockquote>
</div>
<div class="section" id="install-docker-and-docker-compose">
<h2>Install Docker and Docker Compose<a class="headerlink" href="#install-docker-and-docker-compose" title="Permalink to this headline">¶</a></h2>
<p>(<strong>Outside of China</strong>) If you have installed Docker and Docker Compose, you can skip this step. Otherwise You need to install Docker and Docker Compose first.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>curl -sSL https://get.docker.com/ <span class="p">|</span> sh
sudo usermod -aG docker <span class="nv">$USER</span>

sudo sh -c <span class="s1">&#39;curl -L https://github.com/docker/compose/releases/download/1.10.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose&#39;</span>
sudo chmod +x /usr/local/bin/docker-compose
</pre></div>
</div>
<p>(<strong>In China</strong>) If you are in <code class="docutils literal"><span class="pre">China</span></code>, instead you could do:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>curl -sSL https://get.daocloud.io/docker <span class="p">|</span> sh
sudo usermod -aG docker <span class="nv">$USER</span>

sudo sh -c <span class="s1">&#39;curl -L https://get.daocloud.io/docker/compose/releases/download/1.10.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose&#39;</span>
sudo chmod +x /usr/local/bin/docker-compose
</pre></div>
</div>
<p>If this is first time you install Docker and Docker Compose, it is highly recommended to RESTART the machine before you continue:</p>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">reboot</span></code></p>
</div>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>(<strong>CentOS only</strong>) For some Linux version such as CentOS, Docker may not be automatically running after system reboot, in which case you may need to restart Docker process manually first to proceed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">docker</span>
</pre></div>
</div>
<p>(<strong>Outside of China</strong>) To be able to pull the images, you need log into docker hub with your user name which is already authorized by lambdalab
If you haven&#8217;t got authorized, please send an email to <a class="reference external" href="mailto:lambdalab&#37;&#52;&#48;lambdalab&#46;io">lambdalab<span>&#64;</span>lambdalab<span>&#46;</span>io</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
<p>(<strong>In China</strong>) If you are in <code class="docutils literal"><span class="pre">China</span></code>, please use our private registry for better speed.</p>
<p>First, you need to register an account at</p>
<p><code class="docutils literal"><span class="pre">https://registry.lambdalab.io</span></code></p>
<p>and ask <a class="reference external" href="mailto:lambdalab&#37;&#52;&#48;lambdalab&#46;io">lambdalab<span>&#64;</span>lambdalab<span>&#46;</span>io</a> to authorize your account, then you need do</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span> <span class="n">registry</span><span class="o">.</span><span class="n">lambdalab</span><span class="o">.</span><span class="n">io</span>
</pre></div>
</div>
</div>
<div class="section" id="clone-git-repo-for-docker-compose">
<h2>Clone Git Repo for Docker Compose<a class="headerlink" href="#clone-git-repo-for-docker-compose" title="Permalink to this headline">¶</a></h2>
<p>(<strong>Outside of China</strong>) To save unnecessary authentication, the docker compose file and our configuration files (in HOCON format) is release
through public git repo:</p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/lambdalab/lambdalab-docker</span></code></p>
<p>(<strong>In China</strong>) If you are in <code class="docutils literal"><span class="pre">China</span></code>, please use our CSDN git repository:</p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://code.csdn.net/lambdalab/lambdalab-docker.git</span></code></p>
<p>The repo contains two sets of files: docker-compose.yml which is used to start the services. <code class="docutils literal"><span class="pre">configs/*.conf</span></code> files which
are consumed by our services inside the container (the <code class="docutils literal"><span class="pre">configs</span></code> directory is mounted into all the containers that run
our services)</p>
<p>You could customize the services by directly modify the files in the git repo and do rebase everytime we have a update.</p>
<p>All data generated by our services will be stored in <code class="docutils literal"><span class="pre">data</span></code> directory located in the same level with &#8216;docker-compose.yml&#8217;
and all logs generated by our services will be stored in <code class="docutils literal"><span class="pre">logs</span></code> directory.</p>
</div>
<div class="section" id="configure-kerberos-authentication">
<h2>Configure Kerberos Authentication<a class="headerlink" href="#configure-kerberos-authentication" title="Permalink to this headline">¶</a></h2>
<p>This section explains how to integrate insight.io with Kerberos authentication. You can skip this part if you are not using Kerberos authentication.</p>
<p>Log into the machine that host the KDC server and add a principle called &#8216;git&#8217;, if not existed already:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kadmin</span><span class="o">.</span><span class="n">local</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">addprinc</span> <span class="n">git</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ktadd</span> <span class="o">-</span><span class="n">norandkey</span> <span class="n">git</span>
</pre></div>
</div>
<p>Log into the machine that you are planning to run insight.io with, change to user <code class="docutils literal"><span class="pre">root</span></code>, and generate a valid kerberos ticket.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span> <span class="n">root</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kinit</span> <span class="n">git</span>
</pre></div>
</div>
<p>Then the Kerberos authentication part is all-set. insight.io will automatically use the newly generated ticket as authorization credentials. But please make sure the ticket is always valid by manually setting the ticket expiration time or periodically running <code class="docutils literal"><span class="pre">kinit</span></code>.</p>
</div>
<div class="section" id="download-docker-image-and-start-docker-services">
<h2>Download Docker Image and Start Docker Services<a class="headerlink" href="#download-docker-image-and-start-docker-services" title="Permalink to this headline">¶</a></h2>
<p>Under the root of the git repo(lambdalab-docker), run the following script:</p>
<p>(<strong>In China</strong>) If you are in China, please use <strong>./cn-lambda-compose</strong> instead of <strong>./lambda-compose</strong> in all the following cases)</p>
<p><code class="docutils literal"><span class="pre">./lambda-compose</span> <span class="pre">up</span> <span class="pre">-d</span></code></p>
<p>This script will download or upgrade all necessary docker images and start all docker services, it could take a while for the first time. After the script is done, run the following command to verify the services:</p>
<p><code class="docutils literal"><span class="pre">./lambda-compose</span> <span class="pre">ps</span></code></p>
<p>You should see all the docker services lists similar to this:</p>
<img alt="_images/dockerps.png" class="align-center" src="_images/dockerps.png" />
<p>Open a browser and try to access the public DNS of the server with <code class="docutils literal"><span class="pre">http</span></code> protocal. For example, if you are using AWS as your cloud service, this address may look like:</p>
<p><code class="docutils literal"><span class="pre">http://ec2-52-35-135-191.us-west-2.compute.amazonaws.com</span></code></p>
<p>verify that you can see Insight.io home page as showing below:</p>
<img alt="_images/codatlas_homepage.png" class="align-center" src="_images/codatlas_homepage.png" />
<p>You are done with the setting up Insight.io if you are not using it with Github Integration. Please refer to <a class="reference external" href="user_guide.html">User Guide</a> for details on how to use it.</p>
</div>
<div class="section" id="configure-github-integration">
<h2>Configure Github Integration<a class="headerlink" href="#configure-github-integration" title="Permalink to this headline">¶</a></h2>
<p>This section is only necessary if you want to integrate Insight.io with Github, it&#8217;s highly recommended if you use Github as your code hosting service.</p>
<p>Log into your github account and go to <code class="docutils literal"><span class="pre">Settings</span></code> then <code class="docutils literal"><span class="pre">OAuth</span> <span class="pre">applications</span></code> then <code class="docutils literal"><span class="pre">Developer</span> <span class="pre">applications</span></code> tab.</p>
<p>Click on <code class="docutils literal"><span class="pre">Register</span> <span class="pre">new</span> <span class="pre">application</span></code> button and fill in <code class="docutils literal"><span class="pre">Application</span> <span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">Application</span> <span class="pre">description</span></code> section with preferred text. Fill in <code class="docutils literal"><span class="pre">Homepage</span> <span class="pre">URL</span></code> and <code class="docutils literal"><span class="pre">Authorization</span> <span class="pre">callback</span> <span class="pre">URL</span></code> with public DNS of the server, e.g. <code class="docutils literal"><span class="pre">http://ec2-52-35-135-191.us-west-2.compute.amazonaws.com</span></code>. Click <code class="docutils literal"><span class="pre">Register</span> <span class="pre">Application</span></code> to create a new OAuth application. Note <code class="docutils literal"><span class="pre">Client</span> <span class="pre">ID</span></code> and <code class="docutils literal"><span class="pre">Client</span> <span class="pre">Secret</span></code> Github provided with the newly created application.</p>
<p>Go back to the bash terminal, open and edit the <code class="docutils literal"><span class="pre">lambda-enterprise.conf</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>vi ./lambdalab-docker/configs/lambdalab-enterprise.conf
</pre></div>
</div>
<p>And change <code class="docutils literal"><span class="pre">ClientId</span></code> and <code class="docutils literal"><span class="pre">ClientSecret</span></code> fields of both <code class="docutils literal"><span class="pre">github-private</span></code> and <code class="docutils literal"><span class="pre">github</span></code> sections to be the <code class="docutils literal"><span class="pre">Client</span> <span class="pre">ID</span></code> and <code class="docutils literal"><span class="pre">Client</span> <span class="pre">Secret</span></code> of your github application you just created:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>github <span class="o">{</span>
  <span class="nv">authorizationUrl</span><span class="o">=</span><span class="s2">&quot;https://github.com/login/oauth/authorize&quot;</span>
  <span class="nv">accessTokenUrl</span><span class="o">=</span><span class="s2">&quot;https://github.com/login/oauth/access_token&quot;</span>
  <span class="nv">clientId</span><span class="o">=</span>d1d8e43a14e1f3e1e2d8
  <span class="nv">clientSecret</span><span class="o">=</span>ac383f2f378015a06d8d55ef340a029d4314ec0f
  <span class="nv">scope</span><span class="o">=</span><span class="s2">&quot;user:email,public_repo&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>After the change, restart codatlas process:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./lambda-compose restart codatlas
</pre></div>
</div>
<p>Go back to your browser and go to Insight.io Home Page, click on <code class="docutils literal"><span class="pre">Login</span></code> button on the top right, and then click on <code class="docutils literal"><span class="pre">Login</span> <span class="pre">with</span> <span class="pre">Github</span></code>, make sure you can successfully login with your Github account.</p>
<p>You are done with integrate Insight.io with Github! Please refer to <a class="reference external" href="user_guide.html">User Manual</a> for details on how to use it.</p>
</div>
<div class="section" id="configure-gitlab-integration">
<h2>Configure Gitlab Integration<a class="headerlink" href="#configure-gitlab-integration" title="Permalink to this headline">¶</a></h2>
<p>Insight.io also support integration with <code class="docutils literal"><span class="pre">Gitlab</span></code>. This section describes the operations to integrate with <a class="reference external" href="https://gitlab.com/">Gitlab</a>.</p>
<p><strong>Normal Integration</strong></p>
<p>Similar to configuring github integration, the first step is to create a new OAuth application. Log into your gitlab account and go to <code class="docutils literal"><span class="pre">settings</span></code> page, then click on <code class="docutils literal"><span class="pre">Application</span></code> tag, and then enter a name for your application. The name can be any of your preferred strings. Fill the public IP/DNS of your host server into <code class="docutils literal"><span class="pre">Redirect</span> <span class="pre">URI</span></code> followed with &#8220;/authenticate/gitlab&#8221;, e.g. <code class="docutils literal"><span class="pre">http://ec2-52-35-135-191.us-west-2.compute.amazonaws.com/authenticate/gitlab</span></code>. Then add <code class="docutils literal"><span class="pre">api</span></code> scope and <code class="docutils literal"><span class="pre">read_user</span></code> scope. Finally, finish creating the OAuth application by clicking save application.</p>
<p>Go back to the bash terminal, open and edit the <code class="docutils literal"><span class="pre">lambda-enterprise.conf</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>vi ./lambdalab-docker/configs/lambdalab-enterprise.conf
</pre></div>
</div>
<p>Add the authorization/accessToken url and the newly acquired OAUTH client ID and OAUTH client secret into the config:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>gitlab <span class="o">{</span>
  // The OAUTH Client ID
  <span class="nv">clientId</span><span class="o">=</span>YOUR-GITLAB-CLIENT-ID
  // The OAUTH Client secret
  <span class="nv">clientSecret</span><span class="o">=</span>YOUR-GITLAB-CLIENT-SECRET
  <span class="nv">authorizationUrl</span><span class="o">=</span><span class="s2">&quot;http://YOUR-GITLAB-IP/oauth/authorize&quot;</span>
  <span class="nv">accessTokenUrl</span><span class="o">=</span><span class="s2">&quot;http://YOUR-GITLAB-IP/oauth/token&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>After the change, restart codatlas process:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./lambda-compose restart codatlas
</pre></div>
</div>
<p>Go back to your browser and go to Insight.io Home Page, click on Login button on the top right, and then click on Login with Gitlab, make sure you can successfully login with your Gitlab account.</p>
<p><strong>Integration With LDAP</strong></p>
<p>Insight.io also support integration with <code class="docutils literal"><span class="pre">LDAP</span></code> to support user authentication. This section describes how to integrated with both <code class="docutils literal"><span class="pre">LDAP</span></code> and <code class="docutils literal"><span class="pre">Gitlab</span></code>.</p>
<p>To start with, you need to have a functional LDAP server and a Gitlab server. The first step is to integrated Gitlab with LDAP, which has been described by <a class="reference external" href="https://docs.gitlab.com/ce/administration/auth/ldap.html">Gitlab Docs</a>.</p>
<p>After integrating Gitlab with LDAP, we can now start to integrate Insight.io into the stack. Log into your Gitlab admin account and goto <code class="docutils literal"><span class="pre">Profile</span> <span class="pre">Settings</span></code>, then click on the <code class="docutils literal"><span class="pre">Account</span></code> tag to get your <code class="docutils literal"><span class="pre">Private</span> <span class="pre">Token</span></code>.</p>
<p>Go back to the bash terminal, open and edit the <code class="docutils literal"><span class="pre">lambda-enterprise.conf</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>vi ./lambdalab-docker/configs/lambdalab-enterprise.conf
</pre></div>
</div>
<p>Configure the <code class="docutils literal"><span class="pre">ldap</span></code> section under <code class="docutils literal"><span class="pre">securesocial</span></code> like following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>securesocial {

  ldap {

    //  Configurations of other components that integrates with LDAP.
    integration {
      // Gitlab integration.
      gitlab {
        // Gitlab host url.
        gitlabUrl = &quot;YOUR-GITLAB-URL&quot;

        // Gitlab administrator account&#39;s private token.
        rootPrivateToken = &quot;&quot;
      }
    }

    //  the full url of the ldap server, including protocal, hostname and port
    //  e.g. &quot;ldaps://localhost:636&quot; , &quot;ldap://localhost:389&quot;
    providerUrl=&quot;ldap://localhost:389&quot;

    //  search base from which the employee will be searched from
    searchBase=&quot;dc=example,dc=com&quot;

    //  whether to use ssl when search ldap directory
    //  usually if it is turned on, providerUrl should starts with ldaps protocal with 636 port
    //  Also note that if your server is using a self-signed CA, add the CA into the keystore of your jvm otherwise
    //  there will be an SSL handshake error
    // useSsl=true
  }

}
</pre></div>
</div>
<p>After the change, restart codatlas process:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./lambda-compose restart codatlas
</pre></div>
</div>
<p>Go back to your browser and go to Insight.io Home Page, click on Login button on the top right, and the login information should have changed from “Email” to “LDAP Username”, which means you have successfully configured LDAP authentication. Enter your LDAP credentials and you should be abled to login.</p>
<p>You are done with integrate Insight.io with Gitlab! Please refer to User Manual for details on how to use it.</p>
</div>
<div class="section" id="upgrade-insight-io">
<h2>Upgrade Insight.io<a class="headerlink" href="#upgrade-insight-io" title="Permalink to this headline">¶</a></h2>
<p>Upgrading Insight.io is made easy, fast and version-controlled as we manage update process with lambda-docker git repository. The first step of upgrade is save you local config change by &#8216;git commit&#8217; or &#8216;git stash&#8217; and the do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">pull</span> <span class="o">--</span><span class="n">rebase</span>
</pre></div>
</div>
<p>on the docker compose git repo.</p>
<p>Then as mentioned before, if just docker-compose file is changed,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>could automatically restart the outdated
services. However, when config files under <cite>configs</cite> directory changes, <cite>docker-compose up -d</cite> will not know
who to update, therefore, whenever changes are made to the config files, it is more safe to do</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="n">restart</span>
</pre></div>
</div>
<p>to let tasks in containers run with new configs.</p>
</div>
<div class="section" id="deploy-insight-io-with-multiple-machines">
<h2>Deploy Insight.io with Multiple Machines<a class="headerlink" href="#deploy-insight-io-with-multiple-machines" title="Permalink to this headline">¶</a></h2>
<p>If your repositories take a lot of resources to build, it could be helpful or necessary to isolate build related services from frontend services from underlying database and search index. Fortunately Insight.io&#8217;s micro-service architecture and dockerized deployment makes this easy.</p>
<p>The recommended way to seperate the services will be group them into 3 groups, namely:</p>
<ol class="arabic simple">
<li>Frontend services: codatlas, redis, liaceservice, dataservice, projectservice, metadataservice, ngnix, jenkins(master)</li>
<li>Db services: db, elasticsearch</li>
<li>Build services (could have more than one machines): jenkins-slave</li>
</ol>
<p>To start, make sure you have 3 machines ready with docker and docker-compose installed, and lambdalab-docker repository checked out.</p>
<p>On all three machines, switch to <code class="docutils literal"><span class="pre">distributed</span></code> branch by</p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></code></p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">distributed</span></code></p>
<p>and add the hostname of each machine by edit the following file:</p>
<p><code class="docutils literal"><span class="pre">vi</span> <span class="pre">configs/lambdalab-cluster.conf</span></code></p>
<p>Change the following lines of config variable to the hostname of the machines like the following:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># frontend cluster host name, for single machine deployment set this to codatlas</span>
vars.cluster.frontend <span class="o">=</span> <span class="s2">&quot;ec2-35-163-118-155.us-west-2.compute.amazonaws.com&quot;</span>

<span class="c1"># builder cluster host name, for single machine deployment set this to jenkins</span>
vars.cluster.builder <span class="o">=</span> <span class="s2">&quot;ec2-35-164-137-4.us-west-2.compute.amazonaws.com&quot;</span>

<span class="c1"># db cluster host name, for single machine deployment set this to db</span>
vars.cluster.db <span class="o">=</span> <span class="s2">&quot;ec2-35-166-120-102.us-west-2.compute.amazonaws.com&quot;</span>
</pre></div>
</div>
<p>Specify the jenkins master address for their slaves at in <code class="docutils literal"><span class="pre">docker-compose.yml</span></code>. Replace
<code class="docutils literal"><span class="pre">-</span> <span class="pre">JENKINS_MASTER=http://jenkins:8080</span></code> to your jenkins master&#8217;s address.</p>
<p>Run the following command on each machine respectively:</p>
<p>On Frondend machine:</p>
<p><code class="docutils literal"><span class="pre">./lambda-compose</span> <span class="pre">up</span> <span class="pre">-d</span> <span class="pre">liaceservice</span> <span class="pre">dataservice</span> <span class="pre">projectservice</span> <span class="pre">codatlas</span> <span class="pre">nginx</span> <span class="pre">redis</span> <span class="pre">pygments</span> <span class="pre">jenkins</span> <span class="pre">metadataservice</span></code></p>
<p>On Db machine:</p>
<p><code class="docutils literal"><span class="pre">/lambda-compose</span> <span class="pre">up</span> <span class="pre">-d</span> <span class="pre">db</span> <span class="pre">elasticsearch</span></code></p>
<p>On Builder machine(s):</p>
<p><code class="docutils literal"><span class="pre">/lambda-compose</span> <span class="pre">up</span> <span class="pre">-d</span> <span class="pre">jenkins-slave</span></code></p>
<p>After everything is running, you should be able to access Insight.io by visiting frontend machine&#8217;s hostname from your browser.</p>
</div>
<div class="section" id="common-process-management-with-docker-compose">
<h2>Common Process Management with Docker Compose<a class="headerlink" href="#common-process-management-with-docker-compose" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">docker-compose</span></code> is a command line util to manage docker containers. It should be run under the folder where the <code class="docutils literal"><span class="pre">docker-compose.yaml</span></code> exists. We added a simple wrapper around it called <code class="docutils literal"><span class="pre">lambda-compose</span></code> to set all enviroment variables properly.
Common operations are as follows:</p>
<div class="section" id="list-process">
<h3>list process<a class="headerlink" href="#list-process" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="n">ps</span>
</pre></div>
</div>
</div>
<div class="section" id="start-whole-insight-io-enterprise-stack">
<h3>start whole Insight.io enterprise stack<a class="headerlink" href="#start-whole-insight-io-enterprise-stack" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>which is equivalent to use</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</div>
<div class="section" id="start-a-particular-services">
<h3>start a particular services<a class="headerlink" href="#start-a-particular-services" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>./lambda-compose up -d $service
</pre></div>
</div>
</div>
<div class="section" id="attach-to-a-all-containers-output">
<h3>attach to a all containers&#8217; output<a class="headerlink" href="#attach-to-a-all-containers-output" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span>
</pre></div>
</div>
</div>
<div class="section" id="attach-to-a-containers-output">
<h3>attach to a container’s output<a class="headerlink" href="#attach-to-a-containers-output" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>./lambda-compose logs -f $service
</pre></div>
</div>
</div>
<div class="section" id="stop-and-then-clean-all-the-contains">
<h3>stop and then clean all the contains<a class="headerlink" href="#stop-and-then-clean-all-the-contains" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="k">lambda</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span>
</pre></div>
</div>
</div>
<div class="section" id="run-command-inside-similar-to-ssh">
<h3>run command inside (similar to ssh)<a class="headerlink" href="#run-command-inside-similar-to-ssh" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>./lambda-compose run $container /bin/bash
</pre></div>
</div>
</div>
<div class="section" id="find-help">
<h3>find help<a class="headerlink" href="#find-help" title="Permalink to this headline">¶</a></h3>
<p>There are also kill/restart/rm commands if needed. use</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./lambda-compse help $command_name
</pre></div>
</div>
<p>to find more details.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="user_guide.html" class="btn btn-neutral float-right" title="Codatlas New User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index_enterprise.html" class="btn btn-neutral" title="Lambdalab software documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Lambdalab Corp..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>